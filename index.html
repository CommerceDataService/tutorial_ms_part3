<!DOCTYPE html>
<html lang="en">
<head>
    <title>Microsoft - Part 3</title>

    <!-- Javascript -->
    <script src="https://code.jquery.com/jquery-2.2.2.min.js" integrity="sha256-36cp2Co+/62rEAAYHLmRCPIych47CvdM+uTBJwSzWjI=" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
    <script src="js/parallax.js"></script><!-- Parallax Banner -->
    <script src="js/navbar.hide.js"></script><!-- Hide Navbar -->
    <script src="js/scroll.js"></script><!-- Affix Sidebar/Scroll Functions -->

    <!-- CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="css/cdup_tutorial.css"><!-- Custom Theme for know.data tutorial -->
    <link href='https://fonts.googleapis.com/css?family=Coda:400,800' rel='stylesheet' type='text/css'><!-- Google Font for Title -->
    
    <!-- Syntax Highlighting -->
    <!-- Support for the following languages: -->
    <!-- Apache, Bash, C#, C++, CSS, CoffeeScript, Device Tree, Diff, HTML, XML, HTTP, Ini, JSON, Java, JavaScript, Makefile, Markdown, Nginx, Objective-C, PHP, Perl, Python, Ruby, SQL, Fortran, Julia, Lisp, Lua, Mathematica, Matlab, Python-Profile, R, Scilab, Scala, Stata, Swift -->
    <link rel="stylesheet" type="text/css" href="css/styles/github.css"><!-- Style for highlighting Code: Default to Github -->
    <script src="js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script><!-- Activate Code Highlighting -->

</head>
<body>
    <nav id='navbar' class="nav navbar-default navbar-fixed-top navbar-border"><!-- Navbar -->
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#collapse-links" aria-expanded="false">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand navbar-color" href="https://commerce.gov/datausability"><strong>Data Usability</strong></a>
            </div> <!-- navbar-header -->

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="collapse-links">
                <ul class="nav navbar-nav navbar-color">
                    <li class="disclaimer"><a href="https://commerce.gov/datausability">a project by Commerce Data Service</a></li>
                </ul>
                <ul class="nav navbar-nav navbar-right navbar-color">
                    <li><a href="#">Index</a></li>
                    <li><a href="http://microsoft-chicago.com/">Microsoft Chicago</a></li>
                </ul>
            </div><!-- navbar-collapse -->
        </div><!-- container-fluid -->
    </nav>

    <!-- Banner -->
    <section class="scroll " style="font-family:HelveticaNeue-Light">
        <div class="scroll-overlay ">
            <div class="title headtext">
                <small><span class="title-line" style="font-size:120%;"><i> Start Here </i></span></small><br>
                <h1><span class="title-line" style="font-size:150%;">REMIXING WITH POWER BI</span></h1>
                <h4><span class="title-line">Part 3: Clean, Query, Merge</span></h4>
                <h5 ><span class="title-line">by ADAM J. HECKTMAN & FRANK J. LA VIGNE, MICROSOFT CHICAGO</span></h5>
                <h5><span class="title-line">edited by STAR YING & JEFF CHEN, COMMERCE DATA SERVICE</span></h5>
                <h5><span class="title-line">MAY 2016</span></h5>
            </div>
        </div>
    </section>

    <!-- Body -->
    
    <section>
        <div class="container-fluid content">
            <div class="row">
                
                    
                <div id='' class="hidden-xs hidden-sm col-lg-4 col-md-4">
                    <a href="https://commerce.gov/dataservice"><img class = "footlogo" width="160px"src="img/CDS-horizontal-v2.png"/></a>
                    <a href="https://microsoft.com"><img class = "footlogo"  width="160px"src="img/logo.png"/></a>
                    
                </div>
                <div id='content' class="col-lg-6 col-md-6">
                    <em>As part of the <a href="https://www.commerce.gov/datausability/">Commerce Data Usability Project</a>,  Microsoft Chicago in collaboration with the <a href="https://www.commerce.gov/dataservice/">Commerce Data Service</a> has created a  tutorial that introduces PowerBI as a way to explore Commerce data.  If you have question, feel free to reach out to the Commerce Data Service at <a href="mailto:DataUsability@doc.gov">DataUsability@doc.gov</a>.</em>
                    
                </div>
      
            </div>
            <hr>
            
             <br>
        
            
            <div class="row">
                <div id='content' class="col-lg-10 col-md-10"><!-- Content -->
                <section id='intro' >
                    
                    <p>In the <a href="http://commercedataservice.github.io/tutorial_ms_powerbi/">first tutorial</a> we learned how to use Power BI Desktop app to access data and build data models. In the <a href="http://commercedataservice.github.io/tutorial_ms_part2/">second tutorial</a> we developed a workflow for building reports and publish dashboards, then wrapped up with importing those models and reports into the Power BI web service, where  reports can be published to the web as well as build and share dashboards.</p>
                    <p>In this final tutorial, we will learn to use Power BI Desktop app to transform data from a raw text file into usable information. The workflow is as follows:
                        <ul>
                            <li>Import text file of data from the US Census Bureau</li>
                            <li>Build simple queries to append data</li>
                            <li>Merge multiple data sources</li>
                        </ul>
                    Picking up from the previous tutorial, we will use Building Permits data collected by the Census Bureau. This data series is available on a monthly basis for all US counties and is particularly useful for quantitative research into real estate markets and regional economics. [ ]
                    
                </section>
                <section id = "getdata">
                    <h2 class="sectionhead">GET THE DATA</h2>
                    <p>To get started, we first need to get the data, which has been made available through two different methods. </p>
                        
                    <ul>
                        <li><u>Via the Census Website</u>. The first will be a text file that was downloaded from the US Department of Commerce US Census site â€¦ Click on Home, and click Get Data.  This will bring up the most common formats.  Now you will see an option for a text file.  Navigate to the file Building Permits 2011-Text, which you downloaded as part of your demo folder.</li> 
                        <li><u>Via Github</u>. Data has been downloaded and placed in the 'data' folder in the <a href="https://github.com/CommerceDataService/tutorial_ms_part3/tree/master/data">Github repo</a></li>
                    </ul>
                    
                </section>
                    
         
                 <section id='cleaning' >
                    <h2 class="sectionhead">CLEANING DATA</h2>
                    <p> As we did in Part 1, we will need to do some minor cleansing of this data file. We can do this before we even load it.  You will see a preview of this file like this:</p>
                    <br><br>
                    <img src="img/image1.png" style="width: 100%">
                    <br><br>
                    <p>Click on Edit.  From here, you will see several columns that we will not need, and at least one that we want to add (the country).  First, click on the first two columns (labeled "CSA" and "CBSA" respectively).  Once they are selected, click on Remove Columns from the ribbon.</p>
                    <p>Next, we have some cleaning to do in the Name column.  Let's start by renaming it to Metro Region.  Right click on the column name, and click on Rename.  Call it "Metro Region".  Notice that there are some random "*" characters in this column.  They are easily removed all at once.  Click on "Replace Values" from the Transform Section of the Home tab on the ribbon.  Replace the "*" character and leave the "Replace With" field blank.  Click on OK, and the asterisks disappear. </p>

                </section>
                <section id='columns' >
                    <h2 class="sectionhead">CREATING + MERGING COLUMNS</h2>
                    <p>Now, we are going to add United States to the Metro Region column.  The way we will do this is by first creating a column to hold the country name, and then merging that with the Metro Region column.  We can create and populate the Country column in one step.  First, click on the Add Column tab on the ribbon.  The first button is Add Custom Column.  This allows you to add a column that contains a formula, values from other columns, etc.  In this case, we are going to create one that is pre-populated with text.  Under "New Column Name" call it Country.  Under "Custom Column Formula" place your cursor next to the = and type ", United States" (including the quotes).  Now you will see you have your column created and all that is left to do is to merge it with the Metro Region column.</p>
                    <p>For the merge, the order you select the columns to be merged is important.  They will be merged in the order you select them.  So first, select the Metro Region column.  Then, holding the Crtl button down, click the Country button.  The choose Merge Columns in the From Text section of the ribbon (still in the Add Column tab).   Now you have a column with real region names, such as "Allentown-Bethlehem-Easton, PA-NJ, United States".  If you choose to map these regions later, you are in great shape.  At this point, you may remove the Metro Region column and the Country column. </p>
                    <p>We want to make this readable, so we will move the Metro Region US column as the first column.  To do this, select that column and drag it to the left so that it is the first column.  It should look like this:</p>
                    <br><br>
                    <img src="img/image2.png" style="width: 70%">
                    <br><br>
                    <p>Now, we will bring in four data sets, in three different formats, and use them to create our first query: an append query.</p>
                </section>
                
                <section id='query' >
                    <h2 class="sectionhead">QUERY?</h2>
                    <p>The first thing we need to do is to connect to the data that we want to use to build our query.  Our query will bring together all of the data sets that differ only by the year.  There is a text file that we just worked with for Building permits in 2011; there is an Excel workbook for the building permits in 2012; there is a CSV file for the building permits in 2013; and another Excel workbook for building permits in 2014.  We are going to combine them into a single query representing four years' worth of data.</p>
                    <p>Right now, we have only one query, the one built from the 2011 data (which was text):</p>
                    <br><br>
                    <img src="img/image3.png" style="width: 70%">
                    <br><br>
                    <p>Click on New Source to build the next query, the building permits in 2012.  This time, choose Excel as the source.  Navigate to Building Permits 2012 and load it.  Select the first column (Metro Region US) and choose Replace Values.  Replace the "*" character with a blank.</p>
                    <p>Click on New Source again.  This time, we will load a CSV file.  Navigate to Building Permits 2013 and load it.  Again, replace the "*" character with a blank.  Our final file will be another Excel file.  Click on New Source/Excel and navigate to Building Permits 2014.  Load it, and again replace the "*" value with a blank.</p>
                    <p>Now you should have 4 queries in the left pane.  With the Building Permits 2014 selected, click on Append Queries in the Combine section of the Ribbon (Home tab).  This will allow you to take tables that have the exact same column names and bring them together.  You can select two tables and append them, or three or more.  Choose 3 or more. Click ok.  Now you have a single table with all of the years.  This will make it easier to do analysis by year.  It also makes it easy to create visuals in other software, like 3D maps over time in Microsoft Excel.</p>
                </section>
        
                 <section id='merge' >
                    <h2 class="sectionhead"> MERGE!</h2>
                    <p>More often, you will want to combine tables with different columns.  For example, let's say that you want to take the US Census table that shows the population of Metro Areas in 2012, and combine it with the Building Permits Table for 2012.  You will want to combine the population estimate where the metro area matches.</p>
                    <p>The US Census uses a useful measure called CBSA or Core Based Statistical Area.  CBSA is a U.S. geographic area that centers on an urban center of at least 10,000 people and adjacent areas.  It assigns a value to each metro area.  In your demo folder is an Excel file for the population estimate that uses the CSA (it was taken from <a href="http://www.census.gov/popest/data/metro/totals/2012/index.html">U.S. Census population estimate totals</a> ).  The demo folder also includes the original Building Permits 2012 data that included CBSA.  Start a new Power BI session.  Click on New Source and choose Excel.  Navigate to the population data, which is stored in a file called CBSA-EST2012-01 (choose the first table).  It may not all be obvious, but you have to do a little cleansing.  Click on Edit instead of Load.  The CBSA is in text format!  It should be a number to match what is in the Building Permit spreadsheet (which we will load later). </p>
                    <p>First, give the columns meaningful names.  An easy way to do this, since you have a column that could represent headings, is to click on Use First Row As Headers:</p>
                    <br><br>
                    <img src="img/image4.png" style="width: 100%">
                    <br><br>
                    <p>Next, select the CBSA column. Change the Data Type from Text to Whole Number.  You will see the column of numbers go from left justified to right justified, a sure confirmation that they are numbers:</p>
                    <br><br>
                    <img src="img/image5.png" style="width: 100%">
                    <br><br>
                    <p>It is also more clear if you change the column heading 2012 to Population.</p>
                    <p>Now you are ready to bring in your second table, the Building Permits from 2012.  Click on New Source/Excel and navigate to the Excel file called Building Permits 2012 with CBSA.  When it is in the Query Editor, remember to remove those "*" characters in the Name column.   We will stay on this table and add the population data from the Census table.</p>
                    <p>Click on the Merge Queries button on the ribbon in the Combine section.</p>
                    <br><br>
                    <img src="img/image6.png" style="width: 100%">
                    <br><br>
                    <p>Now you are asked what table you want to get the new data from.  You only have one other table, so choose the 2012 Census data table.  It now needs to know which column has the common data.  It's the CBSA!  You could also use the metro name if you are 100% certain that they are the same, but CBSA is safer, so select CBSA in both tables, then choose OK.</p>
                    <br><br>
                    <img src="img/image7.png" style="width: 70%">
                    <br><br>
                    <p>You now have a new column in your table.  You can decide what columns from the Census table you would like to include in your permit table.</p>
                    <p>Select the column called NewColumn. Power BI can do its best to cleanse the data before you expand it by clicking on Remove Errors from the ribbon.  Do this. Clicking on the expand button on the right side of the new column heading will give you your choice of new columns (notice that you can choose more than one).</p>
                    <br><br>
                    <img src="img/image8.png" style="width: 60%">
                    <br><br>
                    <p>Deselect everything but population.  Click on OK.  Now you will have a table that includes not only your building permit data from 2012, but census data for every region for which census data exists.</p>
                    <br><br>
                    <img src="img/image9.png" style="width: 100%">
                    <br><br>
                    <p>Once you know how to do these two types of queries (Append and Merge) you can expand into other areas of Power BI.  You can create custom queries from multiple tables.  You can create custom columns that are calculated.  And, of course, you can use the other features you learned from the other Power BI tutorials to visualize, report on, and share that data.</p>
                </section>
                    
                </div><!-- Content -->
                  
                <div id='sidebar' class="hidden-xs hidden-sm col-lg-2 col-md-2"><!-- Sidebar -->
                       
                    <ul id='featured-nav' class="nav nav-list featured-nav nav-stacked">
                      
                        
                        <li>
                            <ul class="fa-style"><!-- Font Awesome -->
                               <!-- <li><a href="https://github.com/CommerceDataService/tutorial_ms_powerbi"><i class="fa fa-file-archive-o fa-lg"></i></a></li>
                                <li><a href="https://github.com/CommerceDataService/tutorial_ms_powerbi"><i class="fa fa-file-code-o fa-lg"></i></a></li>
                                <li><a href="https://github.com/CommerceDataService/tutorial_ms_powerbi"><i class="fa fa-github-square fa-lg"></i></a></li>-->
                            </ul>
                        </li>
                        <li>
                            
                        </li>
                        <li>
                            <ul class="fa-style"><!-- Font Awesome -->
                                <!--<li><a href="https://github.com/CommerceDataService/tutorial_ms_powerbi"><i class="fa fa-file-archive-o fa-lg"></i></a></li>
                                <li><a href="https://github.com/CommerceDataService/tutorial_ms_powerbi"><i class="fa fa-file-code-o fa-lg"></i></a></li>
                                <li><a href="https://github.com/CommerceDataService/tutorial_ms_powerbi" title="Github Repo for MS Power BI Part 1"><i class="fa fa-github-square fa-lg"></i></a></li>-->
                            </ul>
                        </li>
                        <li>
                            <ul class="fa-style"><!-- Font Awesome -->
                                <li><a href="https://github.com/CommerceDataService/tutorial_ms_powerbi" title="Github Repo for MS Power BI Part 1"><i class="fa fa-github-square fa-lg"></i></a></li>
                                <li><a href="https://twitter.com/adamhecktman" title="Twitter handle for ADAM HECKTMAN"><i class="fa fa-twitter-square fa-lg"></i></a></li><!-- Haven't added the SNS components -->
                                <li><a href="https://twitter.com/tableteer"  title="Twitter handle for FRANK J. LA VIGNE"><i class="fa fa-twitter-square fa-lg"></i></a></li>
                                <!--<li><a href=""><i class="fa fa-linkedin-square fa-lg"></i></a></li>
                                <li><a href=""><i class="fa fa-facebook-square fa-lg"></i></a></li>-->
                          
                            </ul>
                        </li>
                        <li><a href="#intro">INTRODUCTION</a></li>
                        <li><a href="#getdata">GETTING THE DATA</a></li>
                        <li><a href="#cleaning">DATA CLEANSING</a></li>
                        <li><a href="#columns">CREATING + MERGING COLUMNS</a></li>
                        <li><a href="#QUERY">QUERY?</a></li>
                        <li><a href="#merge">MERGE</a></li>
                        
                    </ul>
                </div><!-- Sidebar -->
            </div><!-- Row -->
        </div><!-- Container-fluid -->
    </div>

</body>
</html>